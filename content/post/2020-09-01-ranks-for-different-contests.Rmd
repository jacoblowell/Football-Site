---
title: Ranks for Different Contests
author: Jake
date: '2020-09-01'
output:
  blogdown::html_page:
    toc: true
    toc_depth: 1
    number_sections: true
slug: ranks-for-different-contests
categories:
  - BestBall
  - NFL
tags: []
---



```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = FALSE , cache = TRUE , warning = FALSE , message = FALSE ,
                      dpi = 180 , fig.width = 8 , fig.height = 5)

```

# Load libraries and data

```{r}
library(tidyverse)
library(lubridate)
library(plotly)
library(tidyquant)
library(scales)
library(reactable)

options(scipen = 99999)

```

##  Underdog Bestball Ownership Table


#  Make reactive table

```{r }


Underdog_Ownership <-   Underdog_Ownership <- read_csv("~/Desktop/BestBall/Data/2020/Underdog Ownership.csv")







Underdog_Ownership <-   Underdog_Ownership   %>%  filter(`Draft Size`  > 11) %>%  mutate(Date = as_date(`Picked At`)   , Player = str_c(`First Name` , " " , `Last Name`)  ,
      Entry_Fee =  case_when( `Draft Entry Fee` > 0 ~ `Draft Entry Fee` , TRUE ~ `Tournament Entry Fee`)   , temp_weight_adp = `Pick Number` * Entry_Fee)  %>%  
  select(Date , Player, `Pick Number` , Entry_Fee  , Team, Position , `Draft Size`  , Draft  , temp_weight_adp)   %>%  
  mutate( QB  = case_when( str_detect(Position , "QB" ) ~ 1 , TRUE ~0     ) ) %>%  group_by(Team, Draft) %>% 
  mutate(Teammates =  n() , With_QB   = sum(QB) ) %>% ungroup()



Underdog_Ownership_Team  <- Underdog_Ownership %>%  group_by(Team  , Draft ) %>%  
  summarise(ADP = mean(`Pick Number`) , Times_Drafted = n() , Earliest = min(`Pick Number`)   , Latest = max(`Pick Number`)   , Range = Latest - Earliest  ,
            Exposure = sum(Entry_Fee) / Times_Drafted ) %>%  ungroup() 


totals <-   Underdog_Ownership %>%  # count(Draft , `Draft Entry Fee`)  %>%  
  filter(Draft == "e1751e0a-47e1-451b-b7ee-188dc51d4428")

Underdog_Ownership_Static  <- Underdog_Ownership %>%  group_by(Player , Position) %>%  
  summarise ( ADP = mean(`Pick Number`) %>%  round(1) , Times_Drafted = n() , Earliest = min(`Pick Number`)   , Latest = max(`Pick Number`)   , Range = Latest - Earliest  ,
            Exposure = sum(Entry_Fee)  ,   Avg_Teamates = mean(Teammates)  %>%  round(1)  , With_QB_Rate1  = mean(With_QB)  , With_QB_Rate = as.factor(scales::percent(With_QB_Rate1))   , Weighted_ADP =  ( sum(temp_weight_adp )/  sum(Exposure  )) %>% round(1))%>% 
  ungroup()  %>%  select(  - Earliest , - Latest , -ADP )  %>%  mutate( Exposure_num = Exposure  ,Exposure = as.factor(scales::dollar(Exposure) )) %>% 
  mutate(Exposure = fct_reorder(Exposure , Exposure_num)    , With_QB_Rate = fct_reorder(With_QB_Rate, With_QB_Rate1)) %>% select(-Exposure_num  , - With_QB_Rate1 ) # Exposure_num was used to sort factor


reactable(Underdog_Ownership_Static  ,filterable = TRUE  ,searchable = TRUE ,  style = list(fontFamily = "Work Sans, sans-serif", fontSize = "12px"),fullWidth = TRUE,
  width = "auto") 


totals <-   Underdog_Ownership %>%   count(Draft , Entry_Fee)

```




